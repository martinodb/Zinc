%% -*- LaTex -*-
\documentclass[letterpaper,colorlinks=true,linkcolor=blue]{book}
\usepackage{times}
\usepackage{helvet}
\usepackage{courier}
\usepackage{apalike}
\usepackage{makeidx}
\usepackage{multicol}
\usepackage{url,hyperref}
\usepackage{color}
\usepackage[final]{graphics}
\usepackage[final]{graphics}
\usepackage{authblk}

\setlength{\affilsep}{1em}
\renewcommand*{\Authfont}{\bfseries}

\makeindex

\oddsidemargin 0.5in
\evensidemargin 0in
\marginparwidth 0in
\marginparsep 0in
\textwidth 6in
\topmargin 0in
\textheight 8.5 in

\newcommand{\ct}[1]{{\ttfamily #1}} % argument set in tt type
                                    % (``computer type'')
\newcommand{\cv}[1]{{\ttfamily{\itshape #1}}} % argument set in
                                              % italic tt type
                                              % (``computer variable'') 
\newcommand{\indexct}[1]{\index{#1@\ct{#1}}} % Index a computer term
\newcommand{\indexglobal}[1]{\index{#1@\ct{*#1*}}} % Index a global variable
\newcommand{\indexsv}[1]{\index{#1@\ct{#1}!SNEPSUL variable}}
\newcommand{\docfun}[2]{\vspace{3ex}\par\noindent\ct{(#1
#2)}\indexct{#1}\hfill [\textit{Function}]\newline}
\newcommand{\docmacro}[2]{\vspace{3ex}\par\noindent\ct{(#1
#2)}\indexct{#1}\hfill [\textit{Macro}]\newline}
\newcommand{\docvar}[1]{\vspace{3ex}\par\noindent\ct{*#1*}\indexglobal{#1}\hfill
  [\textit{Variable}]\newline}
\newcommand{\pathdef}[1]{\vspace{3ex}\par\noindent{\ttfamily #1}\newline}
\newcommand{\cable}[2]{$\langle$\texttt{#1, \{#2\}}$\rangle$}
\newcommand{\cableset}[1]{\texttt{\{#1\}}}
\newcommand{\lcableset}[2]{\texttt{#1:\{#2\}}} % labelled cableset

\title{\bf CSNePS USER'S MANUAL\thanks{The development of SNePS was supported
    in part by: the National Science Foundation under Grants IRI-8610517 and
    REC-0106338; the Defense Advanced Research Projects Agency under Contract
    F30602-87-C-0136 (monitored by the Rome Air Development Center) to the
    Calspan-UB Research Center; the Air Force Systems Command, Rome Air
    Development Center, Griffiss Air Force Base, New York 13441-5700, and the
    Air Force Office of Scientific Research, Bolling AFB DC 20332 under Contract
    No.  F30602-85-C-0008, which supported the Northeast Artificial Intelligence
    Consortium (NAIC); NASA under contract NAS 9-19335 to Amherst Systems, Inc.;
    ONR under contract N00014-98-C-0062 to Apple Aid, Inc.; the U.S. Army CECOM
    Intelligence and Information Warfare Directorate (I2WD) through a contract
    with CACI Technologies and through Contract \#DAAB-07-01-D-G001 with
    Booze$\cdot$Allen \& Hamilton; and a Multidisciplinary University Research
    Initiative (MURI) grant (Number W911NF-09-1-0392) for ``Unified Research on
    Network-based Hard/Soft Information Fusion,'' issued by the US Army Research
    Office (ARO) under the program management of Dr. John Lavery.}}

%\author{ \bf
%Stuart C. Shapiro \\ \bf
%Daniel R. Schlegel \\ \bf
%and \\ \bf
%The SNePS Implementation Group \\[2ex] \bf
%Department of Computer Science and Engineering\\ \bf
%State University of New York at Buffalo \\ \bf
%226 Bell Hall\\ \bf
%Buffalo, NY 14260-2000 \\[2ex] \bf
%\date{\today}}

\author[1]{Stuart C. Shapiro}
\author[2]{Daniel R. Schlegel}
\author[ ]{The SNePS Implementation Group}
\affil[1]{Department of Computer Science and Engineering \protect\\ 
State University of New York at Buffalo  \protect\\ 
338 Davis Hall \protect\\
Buffalo, NY 14260-2500\protect\vspace{1em}}
\affil[2]{Department of Computer Science\protect\\
State University of New York at Oswego\protect\\
396 Shineman Center\protect\\
Oswego, NY 13126}

\renewcommand\Authands{ and }


\begin{document}
\frontmatter
\maketitle

\pagebreak
Over the years, many people have contributed to the design and
implementation of SNePS, and to the writing of successive versions of
the SNePS User's Manual.  They constitute ``The SNePS Implementation
Group'' cited on the title page, and I am grateful to them.  They are
listed here.  If I have inadvertently omitted anyone's name, or have
mispelled anyone's name, please let me know, and I will correct it for
the next printing of this Manual.
\begin{multicols}{3}
\noindent Syed S. Ali\\
Michael J. Almeida\\
Charles W. Arnold\\
Robert J. Bechtel\\
Sudhaka Bharadwaj\\
Bharat Bhushan\\
Jonathan Bona\\
Jong S. Byoun\\
Alistair E. Campbell\\
Scott S. Campbell\\
Hans Chalupsky\\
Chung M. Chan\\
Robert G. Church\\
Joongmin Choi\\
Chi C. Choy\\
Soon Ae Chun\\
Maria R. Cravo\\
Zuzana Dobes\\
Gerard F. Donlon\\
Nicholas E. Eastridge\\
Elissa Feit\\
David Forster\\
Richard B. Fritzson\\
James Geller\\
Susan M. Haller\\
Richard G. Hull\\
Haythem Ismail\\
Frances L. Johnson\\
Steven D. Johnson\\
Darrel L. Joy\\
Sudha Kailar\\
Michael Kandefer\\
Sijun Kang\\
Deepak Kumar\\
Stanley C. Kwasny\\
John S. Lewocz\\
Naicong Li\\
John D. Lowrance\\
Christopher Lusardi\\
Anthony S. Maida\\
Mark D. Malamut\\
Nuno Mamede\\
Jo\~{a}o P. Martins\\
Pedro A. Matos\\
Donald P. McKay\\
James P. McKew\\
Ernesto J. Morgado\\
William A. Neagle\\
Jeannette G. Neal\\
Jane Terry Nutter\\
Rafail Ostrovsky\\
Sandra L. Peters\\
Anthony S. Petre\\
David R. Pierce\\
Carlos Pinto-Ferreira\\
William J. Rapaport\\
Victor H. Saks\\
John F. Santore\\
Daniel R. Schlegel\\
A. Patrice Seyed\\
Harold L. Shubin\\
Reid G. Simmons\\
Benjamin R. Spigle, Jr.\\
Rohini K. Srihari\\
William M. Stanton\\
Jennifer M. Suchin\\
Lynn M. Tranchell\\
Jason C. Van Blargan\\
Nicholas F. Vitulli\\
Diana K. Webster\\
Janyce M. Wiebe\\
Zhaomo Yang\\
Albert Hanyong Yuhan\\
Martin J. Zaidel
\end{multicols}

\begin{flushright}
Stuart C. Shapiro
\end{flushright}

\tableofcontents

\cleardoublepage
\addcontentsline{toc}{chapter}{List of Figures}
\listoffigures

\mainmatter

\chapter{Syntax}
\section{Notation}
The syntax is given in this chapter using Extended Backus-Naur Form (EBF).
Terminal symbols are surrounded by the quotation marks ``\texttt{`}'' and
``\texttt{'}''.  Sequences of items are separated by commas, ``\texttt{,}''.
Parentheses ``\texttt{(}'' and ``\texttt{)}'' are used as grouping brackets.
Alternatives are separated by ``$\mid$''.  Optional symbols are surrounded by
``\texttt{[}'' and ``\texttt{]}''.  Material that can be repeated zero or more
times is followed by ``$^\ast$''.  Material that can be repeated one or more
times is followed by ``$^+$''.  Each syntactic rule is terminated by
``\texttt{;}''.  Material starting with ``\texttt{//}'' and extending to the end
of the line is a comment.  The symbol $\not b$ appearing instead of a comma
indicates that the two surrounding items are to appear without whitespace
separating them; otherwise consecutive items must be identifiable to the reader
as separate tokens.  Items in \textit{italics} are expected to be understood
without definition herein.  The characters $i$, $j$, and $k$ stand for any
non-negative integers such that $i \leq j \leq k$.  Material in
\textcolor{red}{red} has not yet been implemented.

\section{Syntax of Well-Formed Terms}\index{syntax}
The language in which CSNePS well-formed terms are expressed is a version of
Common Logic Interchange Format (CLIF) \cite{ISO24707}.  

\texttt{\begin{tabular}{lcl}
wft &=& atomicwft\\
&& $\mid$ `wft'$\not b$  $i$\\
&& $\mid$ `(' , function , argument$^+$ , `)'\\
&& $\mid$ `(' , binaryop , argument , argument , `)'\\
&& $\mid$ `(' , naryop , wft$^\ast$ , `)'\\
&& $\mid$ `(' , param2op , `(' , $i$ , $j$ , `)' wft$^+$ , `)'\\
&& $\mid$ `(' , `thresh' , `(' , $i$ , `)' wft$^+$ , `)'\\
&& $\mid$ `(', `close' , (atomicname $\mid$ (`(',
  atomicname$^+$ , `)')) ,\\
&& ~~~~~wft , `)'\\
&& $\mid$ `(', `every' , atomicname , wft$^\ast$ , `)'\\
&& $\mid$ `(', `some' , atomicname , `(' , atomicname , `)' ,
 wft$^\ast$ , `)'\\ 
&& $\mid$ `(', `?'$\not b$ atomicname , wft$^\ast$ , `)'\\
&& $\mid$ \textcolor{red}{\textit{Generalized quantifiers to replace nexists}} ;\\
[2ex]
binaryop &=& `if' $\mid$ i $\not b$ `=>'
$\mid$ `v=>' ;\\
[2ex]
naryop &=&
 `and' $\mid$ `or' $\mid$ `not' $\mid$ `nor' $\mid$ `thnot' $\mid$
 `thnor' $\mid$ `nand'\\
&& $\mid$ `xor' $\mid$ `iff' ;\\
[2ex]
param2op &=& `andor' $\mid$ `thresh' ;\\
[2ex]
atomicwft &=& atomicname $\mid$ \textit{Lisp string} $\mid$
\textit{Lisp number} ;\\
[2ex]
atomicname &=& \textit{Clojure symbol other than} \texttt{wft}$i$ ;\\
[2ex]
function &=& wft // other than reservedWord ;\\
[2ex]
argument &=& wft $\mid$ `nil' $\mid$ `(' , argumentFunction , wft$^*$ , `)' ;\\
[2ex]
argumentFunction &=& `setof' ;\\
[2ex]
reservedWord &=& `every' $\mid$ `some' $\mid$ `close' $\mid$ `?'$\not
b$ atomicname\\
&& $\mid$ binaryop $\mid$ naryop $\mid$ param2op ;\\
\end{tabular}}\\

Every non-atomic \texttt{wft} (that is, a \texttt{wft} other than an
\texttt{atomicwft}) is given a wft-name when it is stored into the SNePS
knowledge base.  The wft-name of every stored term may be seen by evaluating the
user command \texttt{(list-terms)}\indexct{list-terms}.  The user expression
\texttt{wft\textit{i}} is a syntactic abbreviation of the \texttt{wft} that was
assigned \texttt{wft\textit{i}} as its wft-name.  If no \texttt{wft} has yet
been assigned that wft-name, \texttt{wft\textit{i}} is syntactically illegal.


\section{Syntax of Paths}\label{sec:pathsyntax}
In this section is presented the syntax of path expressions used in
\texttt{definePath}\indexct{definePath} and
\texttt{defineSlot}\indexct{defineSlot}.

\texttt{\begin{tabular}{lcl}
path &=& \textit{slotname}\\
&& $\mid$ \textit{slotname} $\not b$ `-'\\
&& $\mid$ `!'\\
&& $\mid$ `(' , `converse' , path , `)'\\
&& $\mid$ `(' , `kplus' , path , `)'\\
&& $\mid$ `(' , `kstar' , path , `)'\\
&& $\mid$ `(' , `compose' , path$^*$ , `)'\\
&& $\mid$ `(' , `or' , path$^*$ , `)'\\
&& $\mid$ `(' , `and' , path$^*$ , `)'\\
&& $\mid$ `(' , `irreflexive-restrict' , path , `)'\\
&& $\mid$ \textcolor{red}{`(' , `domain-restrict' , `(' , path , wft , `)' , path , `)'}\\
&& $\mid$ \textcolor{red}{`(' , `range-restrict' , path , `(' , path , wft , `)' , `)'} ;
\end{tabular}}

\section[Rule Engine Syntax]{Rule Engine Syntax\footnote{This section adapted from \cite{Sch14}}}\label{sec:rulesyntax}

CSNePS implements a rule language loosely based on a subset of the syntax of CLIPS \cite{clipsref07}, and using concepts from the GLAIR Cognitve Architecture \cite{ShaBon10}. A rule definition takes the following general form: 

\texttt{\begin{tabular}{lcl}
  rule &=& `(defrule', rulename, LHS, `=>' RHS `)';
\end{tabular}}

\noindent where \texttt{rulename} is a unique name for a rule, \texttt{LHS} is the Left Hand Side of the rule (the ``pattern matching'' component\footnote{Really, inference is performed to derive patterns.}), and \texttt{RHS} is the Right Hand Side of the rule (the firing component). The LHS and RHS are discussed in more detail in Sections~\ref{sec:csnepslhs} and~\ref{sec:csnepsrhs}. 

\subsection{The Left Hand Side} \label{sec:csnepslhs}

The LHS of a rule is a collection of generic terms that must be matched for the rule to fire. This portion of the rule is special in that the quantified terms used take wide scope over the entire rule. Continuing the formal definition of the rule language, the LHS is defined as follows:

\texttt{\begin{tabular}{lcl}
  LHS &=& genericterm+;
\end{tabular}}

\noindent where is the definition of a generic term is a term containing an arbitrary term. 

\subsection{The Right Hand Side} \label{sec:csnepsrhs}

The RHS of a rule may contain both Clojure forms and subrules. The set of Clojure forms will be executed in order, and the bindings from the LHS will be substituted in to them. Subrules are rules that are unnamed, and are only executed when the RHS of a rule fires. The subrule is provided the set of LHS bindings, which it may use in its own LHS/RHS. Subrules may themselves have subrules, with no constraint on depth. 

Again continuing the formal definition of the rule language, the RHS is defined as follows:

\texttt{\begin{tabular}{lcl}
  RHS &=& RHSLine+;\\
  RHSLine &=& clojureform | subrule;\\
  subrule &=& `(:subrule' LHS `=>' RHS `)';
\end{tabular}}


\chapter{Getting and Running CSNePS}
CSNePS is implemented in the Clojure programming language, a recently developed 
dialect of lisp which runs (primarily) on the Java Virtual Machine.

\section{Pre-Requisites}

\begin{itemize}
  \item \textbf{git} is a versioning system which will be required. Install it
  by following the appropriate directions for your operating system at \url{http://git-scm.com/downloads}.
  \item \textbf{Leiningen} (aka \textbf{lein}) is a dependency manager for 
  Clojure projects. To install Leiningen, follow the directions at 
  \url{https://github.com/technomancy/leiningen}.
\end{itemize}

\section{Getting CSNePS}

CSNePS will be cloned from its repository using the \texttt{git} tool.

\begin{enumerate}
  \item At the terminal, change directories into the directory which you would like to be the parent of the CSNePS directory. 
  \item Run the command \texttt{git clone https://github.com/SNePS/CSNePS.git}. This will copy CSNePS to your local machine.
\end{enumerate}

\section{Initial Configuration}

\begin{enumerate}
  \item At the command line, run \texttt{chmod 755 /path/of/csneps/csneps.sh}.
  \item At the command line, run \texttt{chmod 755 /path/of/csneps/csnepsgui.sh}.
\end{enumerate}

\section{Running CSNePS at the Command Line}\label{sec:loadcmd}

A script has been provided with the CSNePS distribution which loads CSNePS using leiningen.

\begin{enumerate}
  \item At the command prompt, run the command \texttt{/path/of/csneps/csneps.sh}.
  \item Clojure will load, and you will be presented a 
  Clojure prompt, \texttt{csneps.core.snuser=>}, indicating that CSNePS has loaded and we are in the 'csneps.core.snuser' namespace.
\end{enumerate}

\section{Running the CSNePS GUI}

The CSNePS GUI may be started with or without pre-loading CSNePS. If you choose to pre-load CSNePS you will also have access to the command prompt in your terminal window. This will not be available of you choose not to pre-load CNSePS. 

\subsection{By Pre-Loading CSNePS}

\begin{enumerate}
  \item Follow the directions from Section~\ref{sec:loadcmd}.
  \item Type \texttt{(startGUI)} from the prompt and press enter. This will load the CSNePS GUI.
\end{enumerate}

\subsection{Without Pre-Loading CSNePS}

\begin{enumerate}
  \item At the command prompt, run the command \texttt{/path/of/csneps/csnepsgui.sh}.
  \item CSNePS and its GUI will then load.
\end{enumerate}

\section{Using Eclipse to Run CSNePS}

Before getting started with Eclipse, be sure to check out the Sneps3-Clojure project, change directories to that project, and run \texttt{lein deps} to be sure the project and its dependencies are up to date.

In order to run and develop CSNePS in Eclipse, you will require a version of Eclipse which includes Java support. The version on the CSE servers seems somehow incompatable with CounterClockwise, so I recommend installing the latest version from \url{http://www.eclipse.org} in your home directory.

First we must install the CounterClockwise plugin, which lets us run Clojure apps from Eclipse.

\begin{enumerate}
  \item Click the Help menu, then "Install New Software..."
  \item In the ``Work With:'' field, enter \url{http://ccw.cgrand.net/updatesite/} and click the ``Add...'' button.
  \item Enter "CounterClockwise" (or whatever text you like) in the ``Name'' field and click ``OK''.
  \item Check the box next to "Clojure Programming" in the list that appears, and click the ``Next'' button.
  \item In the dialogs that follow click Next, agree to the license agreement, and click Finish.
  \item Agree to any warnings about unsigned content, and agree to restart Eclipse when installation has finished.
\end{enumerate}

Now we will import our project. 

\begin{enumerate}
  \item Choose "Import..." from the File menu.
  \item Cloose "Existing Project or Workspace" under the "General" node in the tree shown.
  \item With the "Select root directory" radio button selected, click browse and browse to the SNePS3-Clojure directory.
  \item Click next and follow the dialogs until it is imported.
\end{enumerate}

Now the project is imported into Eclipse and we can run it. In the project explorer on the left side of the workspace, expand the SNePS3-Clojure node and then the src node, right click on core.clj, and choose to run it as a Clojure Application. Once the repl loads, run \texttt{(loadsneps3)}.

\section{Using Emacs to Run CSNePS}

\subsection{Configuring Emacs}

There are multiple methods for configuring Emacs to run and edit Clojure code. The method described here is the most desirable as of the time of this writing. These instructions require emacs 24, as it has a package facility we will use. 

First, add the following to your emacs initialization file (by default \texttt{~/.emacs.d/init.el}). 

\begin{verbatim}
(require 'package)
(add-to-list 'package-archives
  '("marmalade" . "http://marmalade-repo.org/packages/"))
(add-to-list 'package-archives
  '("melpa-stable" . "http://melpa-stable.milkbox.net/packages/"))

(package-initialize)
\end{verbatim}

Evaluate the buffer with the initialization file, then run \texttt{M-x package-refresh-contents} to pull in the contents of the added package repositories. 

Now, add the following to your initialization file after what you added above. 

\begin{verbatim}
(defvar my-packages '(clojure-mode
                      clojure-test-mode
                      cider))
                      
(dolist (p my-packages)
  (unless (package-installed-p p)
    (package-install p)))
\end{verbatim}

Evaluate the buffer with the initialization file in order to download the required packages. 

\subsection{Loading and Running the Project in Emacs}

\begin{enumerate}
  \item Load Emacs and switch the current directory to the CSNePS directory.
  This is the directory containing the project.clj file which will be used to 
  load the project.
  \item Type \texttt{M-x cider-jack-in}. A Clojure REPL will be started in a new buffer, and you will be presented with a 
  Clojure prompt, \texttt{csneps.core.snuser=>}, indicating we have started in the 'csneps.core.snuser' namespace.
  %\item Execute the clojure-jack-in function, \texttt{M-x clojure-jack-in}. You will
  %then be presented with a Clojure repl displaying \texttt{user=>} indicating we've
  %started in the 'user' package.
  %\item Open the file \texttt{Sneps3-Clojure/src/core.clj}.
  %\item Compile and load the file into the REPL, \texttt{C-c C-k}.
  \item CSNePS is now loaded and is ready to be used.
\end{enumerate}

\chapter{User Commands}
\docfun{adopt-rule}{\textit{rule-name}}
Adopts the rule with the symbol rule-name as its name.

\docfun{adopt-rules}{\textit{rule-names}}
Takes a list of symbolic rule names to be adopted in order, one after the other. Rows may take the form of a single rule name, or a vector of rule names. A vector of rule names will be adopted simultaneously.

\docfun{allTerms}{}
Returns a set of all the terms in the knowledge base.

\docfun{ask}{\textit{expr}}
Attempts to derive the term \texttt{expr} or its negation. Returns the derived term, or nil if it is not derivable in the current context. If the term is not derivable, focused inference is left running until it is derived, or the task is canceled using \textit{cancel-infer-of} or \textit{cancel-focused-infer}.

\docfun{askif}{\textit{expr}}
Attempts to derive the term \texttt{expr}. Returns the derived term, or nil if it is not derivable in the current context. If the term is not derivable, focused inference is left running until it is derived, or the task is canceled using \textit{cancel-infer-of} or \textit{cancel-focused-infer}.

\docfun{askifnot}{\textit{expr}}
Attempts to derive the negation of the term \texttt{expr}. Returns the derived term, or nil if it is not derivable in the current context. If the term is not derivable, focused inference is left running until it is derived, or the task is canceled using \textit{cancel-infer-of} or \textit{cancel-focused-infer}.

\docfun{askwh}{\textit{exprpat}}
Returns a set of substitutions for variable placeholders for the term pattern \cv{exprpat} that are currently derivable in the current context; or the empty set if there are none. If no instances are derivable, focused inference is left running until an instance is derivable, or the task is canceled using \textit{cancel-infer-of} or \textit{cancel-focused-infer}.

\docfun{assert}{\textit{expr}}
Asserts the term expressed by \cv{expr} in the current context.

\docfun{assert!}{\textit{expr}}\indexct{assert"!}
Asserts the term expressed by \cv{expr} in the current context, and triggers
forward inference.

%\docfun{attachPrimaction}{\textit{term primfun}}
%Puts the function named \texttt{\textit{primfun}} in the
%\texttt{primaction} slot of the given \texttt{\textit{term}}, which
%must be an \texttt{Act} or an \texttt{Action}.  If
%\texttt{\textit{term}} is an \texttt{Act}, it can then be
%\texttt{perform}ed; if it is an \texttt{Action}, an \texttt{Act} can
%then be \texttt{perform}ed whose \texttt{Action} is \texttt{\textit{term}}.

\docfun{cancel-focused-infer}{}
Cancels all focused inference tasks. 

\docfun{cancel-infer-from}{\textit{exprpat}}
Cancels any forward focused reasoning tasks deriving from \textit{exprpat}.

\docfun{cancel-infer-of}{\textit{exprpat}} 
Cancels any focused reasoning tasks attempting to derive \textit{exprpat}.

\docfun{clearkb}{\&optional (\textit{clearall} nil)}
Reinitializes the SNePS knowledge base.  If \cv{clearall} is
non-\texttt{nil} also reinitializes all slots, caseframes, 
and semantic types.

\docfun{currentContext}{}
Returns the current context.

\docfun{defineCaseframe}{\textit{type frame}
 \&key \textit{docstring fsymbols}}
Defines a caseframe, where: \cv{type} is the name of a SNePS semantic
type; \cv{frame} is either \texttt{(\textit{slot1 ... slotn})} or
\texttt{('\textit{function-symbol slot1 ... slotn})}; \cv{docstring}
is a caseframe documentation string; \cv{fsymbols} is a list of
function symbols required if \texttt{first} of the \cv{frame} is not
quoted.

\docfun{defineContext}{\textit{name} \&key (\textit{docstring} "")
  (\textit{parents} '(BaseCT)) \textit{hyps}}
Defines a new context with the given name, docstring, parent contexts,
and initial hypotheses.  If \cv{dosctring} is omitted, it defaults to
the empty string.  If \cv{parents} is omitted, it defaults to
\texttt{'(BaseCT)}.  If \cv{hyps} is omitted, it defaults to the
empty list.

\docfun{definePath}{\textit{slotname path}} Given a slot name, \cv{slotname},
and a path expression, \cv{path} (\textit{see} \S\ref{sec:pathsyntax}), generate
the functions that will compute that path and its converse, and store them in
the slot named \cv{slotname}.

%\docmacro{definePrimaction}{\textit{primactionfun vars} \&body
%  \textit{forms}} Creates the primitive action function named
%\texttt{\textit{primactionfun}}.  \texttt{\textit{vars}} should be a
%(possibly empty) list of slot names that get bound to the appropriate
%node sets.  However, if any \texttt{\textit{var}} is enclosed in
%parentheses, it gets bound to a member of the appropriate node set.
%\texttt{\textit{forms}} syntax is just as it is for \texttt{defun}.
%Returns the function name, \texttt{\textit{primactionfun}}.

\docmacro{defineSlot}{\textit{name} \&key \textit{type docstring
    posadjust negadjust min max path}}

Defines the slot named \cv{name}.  \cv{type} must be a semantic
type.  It defaults to \texttt{Entity}.  \cv{docstring} must be a
string.  It defaults to the empty string.  \cv{posadjust} must be
either \texttt{reduce} (default), \texttt{expand}, or \texttt{none}.
\cv{negadjust} must be either \texttt{reduce}, \texttt{expand}
(default), or \texttt{none}. \cv{min} must be a positive integer.  It
defaults to \texttt{1}. \cv{max} must be either \texttt{nil} (default)
or an integer equal to or greater than \cv{min}.  \cv{path} must be
either \texttt{nil} (default) or a path (\textit{see} \S\ref{sec:pathsyntax}).

\docfun{defineTerm}{\textit{term \&optional (semtype 'Entity)}}
If \texttt{\textit{term}} is not already a term in the SNePS knowledge
base, it is added to the KB with the semantic type
\texttt{\textit{semtype}}, which defaults to \texttt{Entity}.
If \texttt{\textit{term}} is already a term in the KB with semantic
type \texttt{\textit{currenttype}}:
\begin{itemize}
\item if \texttt{\textit{currenttype}} is a subtype of
  \texttt{\textit{semtype}}, the type of \texttt{\textit{term}} is left as is;
\item if \texttt{\textit{semtype}} is a subtype of
  \texttt{\textit{currenttype}}, the semantic type of
  \texttt{\textit{term}} is lowered to \texttt{\textit{semtype}};
\item if \texttt{\textit{currenttype}} and \texttt{\textit{semtype}}
  have one greatest common subtype, the semantic type of
  \texttt{\textit{term}} is changed to that type;
\item if \texttt{\textit{currenttype}} and \texttt{\textit{semtype}}
  have several greatest common subtypes, the user is asked which one (s)he
  wants \texttt{\textit{term}} to be, and \texttt{\textit{term}}'s
  semantic type is changed to that type;
\item otherwise, an error is generated.
\end{itemize}
The term is returned.

\docmacro{defineType}{\textit{newtype supers} \&optional
  \textit{docstring}}
Defines \cv{newtype} to be a SNePS semantic type, and a subtype of the
types listed in the list \cv{supers}. Internally converts types to keywords, 
but accepts either keywords or symbols as arguments to maintain compatibility 
with SNePS 3.  If \cv{docstring} is given, it is set as the documentation string of 
the new type. Prints a message, either of success or what the problem was. 
Returns nil.

\docfun{demo}{\&key file pause failonerror}
Echoes and evaluates the forms in the \cv{file}.  If \cv{pause} is
non-\texttt{nil} (the default is \texttt{nil}), will pause after
echoing each form, but before evaluating it.  If the \cv{file} is
omitted, a menu will be presented of available demos. By default, an erroneous 
form will not stop the demo from continuing, but this may be changed by
setting \cv{failonerror} to a non-nil value.

%\docmacro{describe-terms}{\&rest \textit{ftnames}}
%Prints a description of all the given terms.

%\docfun{erase-term}{\textit{term}}
%Erases the \textit{term} from the knowledge base completely. Returns 
%the term if successful, nil if there are dependencies that prevent the 
%term from being erased.

\docmacro{defrule}{\textit{rulename} \&rest {\textit{body}}}
Defines a rule in the CSNePS rule engine, as described in Section~\ref{sec:rulesyntax}.

\docfun{find}{\textit{exprpat}}
Returns a list of vector pairs. In each pair, the first element is an instance of  \textit{exprpat} in the knowledge base, and the second is a substitution, which when applied to
\textit{exprpat} would give that instance. \textit{exprpat} may be any wft
with variables, symbols starting with a ``?'', in the place of any subterms.

\docfun{findTerm}{\textit{name}}
Returns the term named \texttt{\textit{name}}, or \texttt{nil} if
there isn't one.  The name of an atomic term is a symbol, string, or
number.  The name of a molecular term is its wftname.

\docfun{krnovice}{\textit{boolean}}
If set to \texttt{true} (the default value is \texttt{false}), slots
and caseframes will automatically be created whenever a function symbol is used
that is not already associated with a caseframe.  The slots will be named
\texttt{fn}, \texttt{arg1}, \texttt{arg2}, \textit{etc.}, and both slots and
caseframes will have their default parameters.  This should only be used by
novices, or for very quick tests, as the careful modeling required by defining
types, slots, and caseframes might be ignored.

\docfun{list-caseframes}{}
Prints all the caseframes.

\docfun{listContexts}{}
Prints a list of all the contexts.

\docfun{list-focused-reasoning-tasks}{}
Prints a list of all of the focused reasoning tasks, backward and forward.

\docfun{list-slots}{}
Prints a list of all the SNePS slots.

\docfun{list-terms}{\&key (:asserted nil) (:types nil) (:originsets nil) (:properties nil) (:ontology nil)}
Prints a list of all the terms in the KB, except ontological terms in the OntologyCT context. These may be seen by setting \texttt{:ontology} non-nil.  If \texttt{:asserted} is non-nil,
only asserted propositions will be printed.  If \texttt{:types} is non-nil, the type of
each term will also be printed. If \texttt{:originsets} is non-nil, the origin sets of each term will also be printed, and if \texttt{:properties} is non-nil, additional properties of the terms will be printed.

\docfun{listkb}{}
Prints the current context and all propositions asserted in it.

%\docfun{noshowproofs}{}
%Turns off the effects of \texttt{showproofs}.

\docfun{pathsfrom}{\textit{terms path}}
Returns the set of terms at the end of the given \cv{path} (\textit{see}
\S\ref{sec:pathsyntax}) from \cv{terms}, which must be a term, the name of a
term, a list of terms or names of terms, or a set of terms.

%\docfun{perform}{\textit{actform}}
%Performs the \texttt{Act} expressed by the form \texttt{\textit{actform}}.

\docvar{PRECISION}
A positive integer: a floating point number will be rounded to this
number of decimal places before being converted to a term.

\docfun{remove-from-context}{\textit{term} \textit{ctx}}
Removes the provided \textit{term} from the context \textit{ctx}. The term will 
still be asserted in contexts it isn't removed from. 

\docfun{sameFrame}{\textit{newf oldf}}
Associates the same frame associated with the function symbol
\cv{oldf} with the symbol, or list of symbols, \cv{newf}.

\docfun{setCurrentContext}{\textit{ctx}}
If \cv{ctx} is a context name, makes the context named \cv{ctx} the
current context.  If \cv{ctx} is a context, makes it the current
context.  Else raises an error.

%\docfun{showproofs}{\&key (goals nil)}
%Turns on printing of the proofs of derived terms.If \texttt{goals} is
%non-\texttt{nil}, a message is printed whenever: a goal or subgoal is
%issued; a goal or subgoal is found asserted in the knowledge base; a
%rule fires.  If \texttt{goal} is \texttt{nil} (default) a message is
%printed only when a rule fires, thus printing a proof.

\docfun{showTypes}{}
Graphically displays all the defined semantic types.

\docmacro{startGUI}{\&rest \textit{terms}} 
  Starts the CSNePS GUI. Takes a variable number of \texttt{\textit{terms}} to
  display on the graph. Each term is either found or defined using
  \texttt{defineTerm}. If no terms are given, the entire graph will be
  displayed.

\docfun{unassert}{\textit{prop} \&optional (\textit{cntxt} (currentContext))}
Unasserts the proposition \cv{prop} in the given context and all ancestor
contexts.  Currently there is no belief revision, so propositions derived using
\cv{prop} might still be asserted, and prop, itself, might be rederivable.


%\docmacro{withInstances}{(\textit{variables} of \textit{pattern} \&body \textit{forms}}
%For each asserted substitution instance of \cv{pattern}, evaluates
%the forms in \cv{forms}, 
%      with each variable in \cv{variables}
%         taking on the term appropriate for the instance.
%   Question mark variables in \cv{pattern} that are not in \cv{variables}
%      take on the values they should have gotten in an enclosing \texttt{withInstances}.\\
%For example,
%\begin{verbatim}
%(withInstances (?x ?y) of (Isa ?x ?y)
%   (format t "~s is an instance of ~s.~%" ?x ?y))
%\end{verbatim}
%or
%\begin{verbatim}
%(withInstances (?x ?y) of (Isa ?x ?y)
%   (format t "~s is an instance of ~s.~%" ?x ?y)
%   (withInstances (?z) of (Ako ?y ?z)
%      (format t "~s is an instance of ~s, and also of ~s.~%" ?x ?y ?z)
%      (assert `(Isa ,?x ,?z))))
%\end{verbatim}

\docfun{writeKBToTextFile}{\textit{file} \&optional \textit{headerfile}}
Writes the KB to the given text \cv{file}, so that when that file is loaded, all
the propositions asserted in the current KB will be asserted in the new KB.  If
the \cv{headerfile} is included, a load of that file will be written before any
of the asserts.

\chapter{Debug Commands}

The commands listed in this chapter may be useful if you experience issues with CSNePS and wish to attempt to resolve the problem. 

\docfun{build/print-all-trees}{}
Prints all unification term trees to the terminal in a human-readable format.

\docfun{build/print-channel-and-msgs}{\textit{from} \textit{to}}
Given the names of two terms, \textit{from} and \textit{to}, prints the channel (if it exists) from the \textit{from} term to the \textit{to} term. Also prints all messages which are waiting in that channel.

\docfun{snip/ig-status}{}
Prints all channels in the Inference Graph, including their type, number of waiting messages, and any valve selectors.

\docfun{snip/print-waiting-msgs}{\&optional \textit{term}}
Prints messages waiting in channels incoming to \textit{term}, or if \textit{term} is not specified, prints all messages waiting in any channels in the IG.

\docfun{snip/print-ptree}{\textit{ptree}}
Given a P-Tree, \textit{ptree}, prints it to the terminal in a human readable form.

\backmatter
\appendix

\chapter{University at Buffalo Public License (``UBPL'') Version 1.0}
\renewcommand{\thesection}{\arabic{section}.}
\renewcommand{\thesubsection}{\arabic{section}.\arabic{subsection}.}
\setcounter{section}{0}
\section{Definitions.}
\begin{description}
\item [1.0.1. ``Commercial Use'']\mbox{}\\
means distribution or otherwise making the Covered Code available to a third party. 
\item [1.1. ``Contributor'']\mbox{}\\
means each entity that creates or contributes to the creation of Modifications. 
\item [1.2. ``Contributor Version'']\mbox{}\\
means the combination of the Original Code, prior Modifications used by a Contributor, and the Modifications made by that particular Contributor. 
\item [1.3. ``Covered Code'']\mbox{}\\
means the Original Code or Modifications or the combination of the Original Code and Modifications, in each case including portions thereof. 
\item [1.4. ``Electronic Distribution Mechanism'']\mbox{}\\
means a mechanism generally accepted in the software development community for the electronic transfer of data. 
\item [1.5. ``Executable'']\mbox{}\\
means Covered Code in any form other than Source Code. 
\item [1.6. ``Initial Developer'']\mbox{}\\
means the individual or entity identified as the Initial Developer in the Source Code notice required by Exhibit A. 
\item [1.7. ``Larger Work'']\mbox{}\\
means a work which combines Covered Code or portions thereof with code not governed by the terms of this License. 
\item [1.8. ``License'']\mbox{}\\
means this document. 
\item [1.8.1. ``Licensable'']\mbox{}\\
means having the right to grant, to the maximum extent possible, whether at the time of the initial grant or subsequently acquired, any and all of the rights conveyed herein. 
\item [1.9. ``Modifications'']\mbox{}\\
means any addition to or deletion from the substance or structure of either the Original Code or any previous Modifications. When Covered Code is released as a series of files, a Modification is: 
\renewcommand{\theenumi}{\alph{enumi}}
\begin{enumerate}
\item Any addition to or deletion from the contents of a file containing Original Code or previous Modifications. 
\item Any new file that contains any part of the Original Code or previous Modifications. 
\end{enumerate}

\item [1.10. ``Original Code'']\mbox{}\\
means Source Code of computer software code which is described in the Source Code notice required by Exhibit A as Original Code, and which, at the time of its release under this License is not already Covered Code governed by this License. 

\item [1.10.1. ``Patent Claims'']\mbox{}\\
means any patent claim(s), now owned or hereafter acquired, including without limitation, method, process, and apparatus claims, in any patent Licensable by grantor. 
\item [1.11. ``Source Code'']\mbox{}\\
means the preferred form of the Covered Code for making modifications to it, including all modules it contains, plus any associated interface definition files, scripts used to control compilation and installation of an Executable, or source code differential comparisons against either the Original Code or another well known, available Covered Code of the Contributor's choice. The Source Code can be in a compressed or archival form, provided the appropriate decompression or de-archiving software is widely available for no charge. 
\item [1.12. ``You'' (or ``Your'')]\mbox{}\\
means an individual or a legal entity exercising rights under, and complying with all of the terms of, this License or a future version of this License issued under Section 6.1. For legal entities, ``You'' includes any entity which controls, is controlled by, or is under common control with You. For purposes of this definition, ``control'' means (a) the power, direct or indirect, to cause the direction or management of such entity, whether by contract or otherwise, or (b) ownership of more than fifty percent (50\%) of the outstanding shares or beneficial ownership of such entity. 
\end{description}

\section{Source Code License.}
\subsection{The Initial Developer Grant.}
The Initial Developer hereby grants You a world-wide, royalty-free, non-exclusive license, subject to third party intellectual property claims: 
\renewcommand{\theenumi}{\alph{enumi}}
\begin{enumerate}
\item under intellectual property rights (other than patent or trademark) Licensable by Initial Developer to use, reproduce, modify, display, perform, sublicense and distribute the Original Code (or portions thereof) with or without Modifications, and/or as part of a Larger Work; and 

\item under Patents Claims infringed by the making, using or selling of Original Code, to make, have made, use, practice, sell, and offer for sale, and/or otherwise dispose of the Original Code (or portions thereof). 

\item the licenses granted in this Section 2.1 (a) and (b) are effective on the date Initial Developer first distributes Original Code under the terms of this License. 

\item Notwithstanding Section 2.1 (b) above, no patent license is granted: 1) for code that You delete from the Original Code; 2) separate from the Original Code; or 3) for infringements caused by: i) the modification of the Original Code or ii) the combination of the Original Code with other software or devices. 
\end{enumerate}


\subsection{Contributor Grant.}
Subject to third party intellectual property claims, each Contributor hereby grants You a world-wide, royalty-free, non-exclusive license 
\begin{enumerate}
\item under intellectual property rights (other than patent or trademark) Licensable by Contributor, to use, reproduce, modify, display, perform, sublicense and distribute the Modifications created by such Contributor (or portions thereof) either on an unmodified basis, with other Modifications, as Covered Code and/or as part of a Larger Work; and 

\item under Patent Claims infringed by the making, using, or selling
  of Modifications made by that Contributor either alone and/or in
  combination with its Contributor Version (or portions of such
  combination), to make, use, sell, offer for sale, have made, and/or
  otherwise dispose of: 1) Modifications made by that Contributor (or
  portions thereof); and 2) the combination of Modifications made by
  that Contributor with its Contributor Version (or portions of such
  combination). 

\item the licenses granted in Sections 2.2 (a) and 2.2 (b) are effective on the date Contributor first makes Commercial Use of the Covered Code. 

\item Notwithstanding Section 2.2 (b) above, no patent license is granted: 1) for any code that Contributor has deleted from the Contributor Version; 2) separate from the Contributor Version; 3) for infringements caused by: i) third party modifications of Contributor Version or ii) the combination of Modifications made by that Contributor with other software (except as part of the Contributor Version) or other devices; or 4) under Patent Claims infringed by Covered Code in the absence of Modifications made by that Contributor. 
\end{enumerate}

\section{Distribution Obligations.}
\subsection{Application of License.}
The Modifications which You create or to which You contribute are governed by the terms of this License, including without limitation Section 2.2. The Source Code version of Covered Code may be distributed only under the terms of this License or a future version of this License released under Section 6.1, and You must include a copy of this License with every copy of the Source Code You distribute. You may not offer or impose any terms on any Source Code version that alters or restricts the applicable version of this License or the recipients' rights hereunder. However, You may include an additional document offering the additional rights described in Section 3.5. 

\subsection{Availability of Source Code.}
Any Modification which You create or to which You contribute must be made available in Source Code form under the terms of this License either on the same media as an Executable version or via an accepted Electronic Distribution Mechanism to anyone to whom you made an Executable version available; and if made available via Electronic Distribution Mechanism, must remain available for at least twelve (12) months after the date it initially became available, or at least six (6) months after a subsequent version of that particular Modification has been made available to such recipients. You are responsible for ensuring that the Source Code version remains available even if the Electronic Distribution Mechanism is maintained by a third party. 

\subsection{Description of Modifications.}
You must cause all Covered Code to which You contribute to contain a file documenting the changes You made to create that Covered Code and the date of any change. You must include a prominent statement that the Modification is derived, directly or indirectly, from Original Code provided by the Initial Developer and including the name of the Initial Developer in (a) the Source Code, and (b) in any notice in an Executable version or related documentation in which You describe the origin or ownership of the Covered Code. 

\subsection{Intellectual Property Matters}
\subsubsection{(a) Third Party Claims}
If Contributor has knowledge that a license under a third party's intellectual property rights is required to exercise the rights granted by such Contributor under Sections 2.1 or 2.2, Contributor must include a text file with the Source Code distribution titled ``LEGAL'' which describes the claim and the party making the claim in sufficient detail that a recipient will know whom to contact. If Contributor obtains such knowledge after the Modification is made available as described in Section 3.2, Contributor shall promptly modify the LEGAL file in all copies Contributor makes available thereafter and shall take other steps (such as notifying appropriate mailing lists or newsgroups) reasonably calculated to inform those who received the Covered Code that new knowledge has been obtained. 

\subsubsection{(b) Contributor APIs}
If Contributor's Modifications include an application programming interface and Contributor has knowledge of patent licenses which are reasonably necessary to implement that API, Contributor must also include this information in the LEGAL file. 

\subsubsection{(c) Representations.}
Contributor represents that, except as disclosed pursuant to Section 3.4 (a) above, Contributor believes that Contributor's Modifications are Contributor's original creation(s) and/or Contributor has sufficient rights to grant the rights conveyed by this License. 

\subsection{Required Notices.}
You must duplicate the notice in Exhibit A in each file of the Source Code. If it is not possible to put such notice in a particular Source Code file due to its structure, then You must include such notice in a location (such as a relevant directory) where a user would be likely to look for such a notice. If You created one or more Modification(s) You may add your name as a Contributor to the notice described in Exhibit A. You must also duplicate this License in any documentation for the Source Code where You describe recipients' rights or ownership rights relating to Covered Code. You may choose to offer, and to charge a fee for, warranty, support, indemnity or liability obligations to one or more recipients of Covered Code. However, You may do so only on Your own behalf, and not on behalf of the Initial Developer or any Contributor. You must make it absolutely clear than any such warranty, support, indemnity or liability obligation is offered by You alone, and You hereby agree to indemnify the Initial Developer and every Contributor for any liability incurred by the Initial Developer or such Contributor as a result of warranty, support, indemnity or liability terms You offer. 

\subsection{Distribution of Executable Versions.}
You may distribute Covered Code in Executable form only if the requirements of Sections 3.1, 3.2, 3.3, 3.4 and 3.5 have been met for that Covered Code, and if You include a notice stating that the Source Code version of the Covered Code is available under the terms of this License, including a description of how and where You have fulfilled the obligations of Section 3.2. The notice must be conspicuously included in any notice in an Executable version, related documentation or collateral in which You describe recipients' rights relating to the Covered Code. You may distribute the Executable version of Covered Code or ownership rights under a license of Your choice, which may contain terms different from this License, provided that You are in compliance with the terms of this License and that the license for the Executable version does not attempt to limit or alter the recipient's rights in the Source Code version from the rights set forth in this License. If You distribute the Executable version under a different license You must make it absolutely clear that any terms which differ from this License are offered by You alone, not by the Initial Developer or any Contributor. You hereby agree to indemnify the Initial Developer and every Contributor for any liability incurred by the Initial Developer or such Contributor as a result of any such terms You offer. 

\subsection{Larger Works.}
You may create a Larger Work by combining Covered Code with other code not governed by the terms of this License and distribute the Larger Work as a single product. In such a case, You must make sure the requirements of this License are fulfilled for the Covered Code. 


\section{Inability to Comply Due to Statute or Regulation.}
If it is impossible for You to comply with any of the terms of this License with respect to some or all of the Covered Code due to statute, judicial order, or regulation then You must: (a) comply with the terms of this License to the maximum extent possible; and (b) describe the limitations and the code they affect. Such description must be included in the LEGAL file described in Section 3.4 and must be included with all distributions of the Source Code. Except to the extent prohibited by statute or regulation, such description must be sufficiently detailed for a recipient of ordinary skill to be able to understand it. 

\section{Application of this License.}
This License applies to code to which the Initial Developer has attached the notice in Exhibit A and to related Covered Code. 

\section{Versions of the License.}
\subsection{New Versions}
University at Buffalo (``UB'') may publish revised and/or new versions of the License from time to time. Each version will be given a distinguishing version number. 

\subsection{Effect of New Versions}
Once Covered Code has been published under a particular version of the License, You may always continue to use it under the terms of that version. You may also choose to use such Covered Code under the terms of any subsequent version of the License published by UB. No one other than UB has the right to modify the terms applicable to Covered Code created under this License. 

\subsection{Derivative Works}
If You create or use a modified version of this License (which you may only do in order to apply it to code which is not already Covered Code governed by this License), You must (a) rename Your license so that the phrases ``University at Buffalo'', ``University at BuffaloPL'', ``UBPL'' or any confusingly similar phrase do not appear in your license (except to note that your license differs from this License) and (b) otherwise make it clear that Your version of the license contains terms which differ from the University at Buffalo Public License. (Filling in the name of the Initial Developer, Original Code or Contributor in the notice described in Exhibit A shall not of themselves be deemed to be modifications of this License.) 

\subsection{Origin of License}
This License is derived from the familiar Mozilla Public License Version 1.1 (``MPL'') and differs only in that 1) the title now refers to UB to indicate that UB is the licensor; 2) UB retains the sole right to publish revised versions of this license (See 6.1 and 6.2); 3) Section 6.3 now refers to the phrases ``University at Buffalo'', ``University at BuffaloPL'', ``UBPL'';  4) the License shall be governed by law provisions of the state of New York and any litigation relating to this License shall be subject to the jurisdiction of the state and federal courts of the State of New York and all parties consent to the exclusive personal jurisdiction of those courts (See 11); and 5) Research Foundation of State University of New York, on behalf of University at Buffalo is cited as the copyright owner of the original code (See Exhibit A).

\section{DISCLAIMER OF WARRANTY}
COVERED CODE IS PROVIDED UNDER THIS LICENSE ON AN ``AS IS'' BASIS, WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, WITHOUT LIMITATION, WARRANTIES THAT THE COVERED CODE IS FREE OF DEFECTS, MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE OR NON-INFRINGING. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE COVERED CODE IS WITH YOU. SHOULD ANY COVERED CODE PROVE DEFECTIVE IN ANY RESPECT, YOU (NOT THE INITIAL DEVELOPER OR ANY OTHER CONTRIBUTOR) ASSUME THE COST OF ANY NECESSARY SERVICING, REPAIR OR CORRECTION. THIS DISCLAIMER OF WARRANTY CONSTITUTES AN ESSENTIAL PART OF THIS LICENSE. NO USE OF ANY COVERED CODE IS AUTHORIZED HEREUNDER EXCEPT UNDER THIS DISCLAIMER. 

\section{Termination}
\begin{enumerate}
\renewcommand{\theenumi}{\arabic{section}.\arabic{enumi}}
\item This License and the rights granted hereunder will terminate automatically if You fail to comply with terms herein and fail to cure such breach within 30 days of becoming aware of the breach. All sublicenses to the Covered Code which are properly granted shall survive any termination of this License. Provisions which, by their nature, must remain in effect beyond the termination of this License shall survive. 

\item If You initiate litigation by asserting a patent infringement claim (excluding declatory judgment actions) against Initial Developer or a Contributor (the Initial Developer or Contributor against whom You file such action is referred to as ``Participant'') alleging that: 

\renewcommand{\theenumii}{\alph{enumii}}
  \begin{enumerate}
  \item such Participant's Contributor Version directly or indirectly infringes any patent, then any and all rights granted by such Participant to You under Sections 2.1 and/or 2.2 of this License shall, upon 60 days notice from Participant terminate prospectively, unless if within 60 days after receipt of notice You either: (i) agree in writing to pay Participant a mutually agreeable reasonable royalty for Your past and future use of Modifications made by such Participant, or (ii) withdraw Your litigation claim with respect to the Contributor Version against such Participant. If within 60 days of notice, a reasonable royalty and payment arrangement are not mutually agreed upon in writing by the parties or the litigation claim is not withdrawn, the rights granted by Participant to You under Sections 2.1 and/or 2.2 automatically terminate at the expiration of the 60 day notice period specified above. 

\item any software, hardware, or device, other than such Participant's Contributor Version, directly or indirectly infringes any patent, then any rights granted to You by such Participant under Sections 2.1(b) and 2.2(b) are revoked effective as of the date You first made, used, sold, distributed, or had made, Modifications made by that Participant. 
  \end{enumerate}

\item If You assert a patent infringement claim against Participant alleging that such Participant's Contributor Version directly or indirectly infringes any patent where such claim is resolved (such as by license or settlement) prior to the initiation of patent infringement litigation, then the reasonable value of the licenses granted by such Participant under Sections 2.1 or 2.2 shall be taken into account in determining the amount or value of any payment or license. 

\item In the event of termination under Sections 8.1 or 8.2 above, all end user license agreements (excluding distributors and resellers) which have been validly granted by You or any distributor hereunder prior to termination shall survive termination. 
\end{enumerate}

\section{LIMITATION OF LIABILITY}
UNDER NO CIRCUMSTANCES AND UNDER NO LEGAL THEORY, WHETHER TORT (INCLUDING NEGLIGENCE), CONTRACT, OR OTHERWISE, SHALL YOU, THE INITIAL DEVELOPER, ANY OTHER CONTRIBUTOR, OR ANY DISTRIBUTOR OF COVERED CODE, OR ANY SUPPLIER OF ANY OF SUCH PARTIES, BE LIABLE TO ANY PERSON FOR ANY INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES OF ANY CHARACTER INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF GOODWILL, WORK STOPPAGE, COMPUTER FAILURE OR MALFUNCTION, OR ANY AND ALL OTHER COMMERCIAL DAMAGES OR LOSSES, EVEN IF SUCH PARTY SHALL HAVE BEEN INFORMED OF THE POSSIBILITY OF SUCH DAMAGES. THIS LIMITATION OF LIABILITY SHALL NOT APPLY TO LIABILITY FOR DEATH OR PERSONAL INJURY RESULTING FROM SUCH PARTY'S NEGLIGENCE TO THE EXTENT APPLICABLE LAW PROHIBITS SUCH LIMITATION. SOME JURISDICTIONS DO NOT ALLOW THE EXCLUSION OR LIMITATION OF INCIDENTAL OR CONSEQUENTIAL DAMAGES, SO THIS EXCLUSION AND LIMITATION MAY NOT APPLY TO YOU. 

\section{U.S. government end users}
The Covered Code is a ``commercial item,'' as that term is defined in 48 C.F.R. 2.101 (Oct. 1995), consisting of ``commercial computer software'' and ``commercial computer software documentation,'' as such terms are used in 48 C.F.R. 12.212 (Sept. 1995). Consistent with 48 C.F.R. 12.212 and 48 C.F.R. 227.7202-1 through 227.7202-4 (June 1995), all U.S. Government End Users acquire Covered Code with only those rights set forth herein. 

\section{Miscellaneous}
This License represents the complete agreement concerning subject matter hereof. If any provision of this License is held to be unenforceable, such provision shall be reformed only to the extent necessary to make it enforceable. This License shall be governed by law provisions of the state of New York (except to the extent applicable law, if any, provides otherwise), excluding its conflict-of-law provisions. With respect to disputes in which at least one party is a citizen of, or an entity chartered or registered to do business in the United States of America, any litigation relating to this License shall be subject to the jurisdiction of the state and federal courts of the State of New York and all parties consent to the exclusive personal jurisdiction of those courts, with the losing party responsible for costs, including without limitation, court costs and reasonable attorneys' fees and expenses. The application of the United Nations Convention on Contracts for the International Sale of Goods is expressly excluded. Any law or regulation which provides that the language of a contract shall be construed against the drafter shall not apply to this License. 

\section{Responsibility for claims}
As between Initial Developer and the Contributors, each party is responsible for claims and damages arising, directly or indirectly, out of its utilization of rights under this License and You agree to work with Initial Developer and Contributors to distribute such responsibility on an equitable basis. Nothing herein is intended or shall be deemed to constitute any admission of liability. 

\section{Multiple-licensed code}
Initial Developer may designate portions of the Covered Code as ``Multiple-Licensed''. ``Multiple-Licensed'' means that the Initial Developer permits you to utilize portions of the Covered Code under Your choice of the UBPL or the alternative licenses, if any, specified by the Initial Developer in the file described in Exhibit A.  
\newpage
\markright{Exhibit A - University at Buffalo Public License.}
\addcontentsline{toc}{section}{Exhibit A - University at Buffalo Public License.}
\section*{Exhibit A - University at Buffalo Public License.}
The contents of this file are subject to the University at Buffalo
Public License Version 1.0 (the "License"); you may not use this
file except in compliance with the License. You may obtain a copy of
the License at \url{http://www.cse.buffalo.edu/sneps/Downloads/ubpl.pdf}.\\

\noindent Software distributed under the License is distributed on an "AS IS"
basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
License for the specific language governing rights and limitations
under the License.\\

\noindent The Original Code is CSNePS.\\

\noindent The Initial Developer of the Original Code is Research Foundation of State University of New York, on behalf of University at Buffalo.\\

\noindent Portions created by the Initial Developer are Copyright (C) 2007 Research Foundation of State University of New York, on behalf of University at Buffalo. All Rights Reserved.\\

\noindent Contributor(s):\underline{~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~}.\\

\noindent NOTE: The text of this Exhibit A may differ slightly from the text of the notices in the Source Code files of the Original Code. You should use the text of this Exhibit A rather than the text found in the Original Code Source Code for Your Modifications.

\cleardoublepage
\addcontentsline{toc}{chapter}{Bibliography}
\bibliographystyle{apalike}
\bibliography{bib}

\cleardoublepage
\addcontentsline{toc}{chapter}{Index}
\printindex
\end{document}
